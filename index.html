<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water & Sewerage Bill Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .form-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }

        .form-section h2 {
            color: #495057;
            margin-bottom: 25px;
            font-size: 1.4em;
            padding-bottom: 10px;
            border-bottom: 3px solid #007bff;
            display: inline-block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
            font-size: 0.95em;
        }

        input {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
            transform: translateY(-1px);
        }

        .calculate-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 30px auto;
            min-width: 200px;
            box-shadow: 0 5px 15px rgba(40,167,69,0.3);
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40,167,69,0.4);
        }

        .calculate-btn:active {
            transform: translateY(0);
        }

        .results {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 30px;
            margin-top: 30px;
            border: 1px solid #dee2e6;
        }

        .results h2 {
            color: #495057;
            margin-bottom: 25px;
            font-size: 1.4em;
            text-align: center;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .summary-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }

        .summary-item:hover {
            transform: translateY(-2px);
        }

        .summary-item.total {
            background: linear-gradient(135deg, #007bff 0%, #6610f2 100%);
            color: white;
            font-size: 1.1em;
            font-weight: bold;
        }

        .summary-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .summary-value {
            font-size: 1.3em;
            font-weight: 600;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }

        th {
            background: linear-gradient(135deg, #495057 0%, #6c757d 100%);
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9em;
        }

        td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .download-buttons {
            margin-top: 20px;
            text-align: center;
        }

        .download-btn {
            background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%);
            color: white;
            padding: 10px 25px;
            border: none;
            border-radius: 25px;
            font-size: 0.9em;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(111,66,193,0.3);
        }

        .hidden {
            display: none;
        }

        .error {
            color: #dc3545;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }

            .main-content {
                padding: 20px;
            }

            .form-section {
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            th, td {
                padding: 8px 5px;
                font-size: 0.85em;
            }

            .summary-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Water & Sewerage Bill Calculator</h1>
            <p>Calculate your water and sewerage charges with detailed monthly breakdown</p>
        </div>

        <div class="main-content">
            <form id="calculatorForm">
                <div class="form-section">
                    <h2>Tariff Settings</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="waterStanding">Water Standing Charge (£ per annum)</label>
                            <input type="number" id="waterStanding" step="0.01" value="62.40" required>
                        </div>
                        <div class="form-group">
                            <label for="waterVolumetric">Water Volumetric Charge (£ per m³)</label>
                            <input type="number" id="waterVolumetric" step="0.0001" value="1.6195" required>
                        </div>
                        <div class="form-group">
                            <label for="sewerStanding">Sewerage Standing Charge (£ per annum)</label>
                            <input type="number" id="sewerStanding" step="0.01" value="68.00" required>
                        </div>
                        <div class="form-group">
                            <label for="sewerVolumetric">Sewerage Volumetric Charge (£ per m³)</label>
                            <input type="number" id="sewerVolumetric" step="0.0001" value="2.7981" required>
                        </div>
                        <div class="form-group">
                            <label for="sewerAllowance">Sewerage Allowance (%)</label>
                            <input type="number" id="sewerAllowance" step="0.1" value="5" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Meter Readings</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="startDate">Start Date</label>
                            <input type="date" id="startDate" value="2025-05-01" required>
                        </div>
                        <div class="form-group">
                            <label for="startReading">Start Reading (m³)</label>
                            <input type="number" id="startReading" step="0.001" value="3211" required>
                        </div>
                        <div class="form-group">
                            <label for="endDate">End Date</label>
                            <input type="date" id="endDate" value="2025-08-14" required>
                        </div>
                        <div class="form-group">
                            <label for="endReading">End Reading (m³)</label>
                            <input type="number" id="endReading" step="0.001" value="3262" required>
                        </div>
                    </div>
                </div>

                <button type="submit" class="calculate-btn">Calculate Bill</button>
            </form>

            <div id="errorDiv" class="hidden"></div>

            <div id="results" class="results hidden">
                <h2>Calculation Results</h2>
                
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-label">Water Volumetric</div>
                        <div class="summary-value" id="waterVolTotal">£0.00</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Water Standing</div>
                        <div class="summary-value" id="waterStandTotal">£0.00</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Sewer Volumetric</div>
                        <div class="summary-value" id="sewerVolTotal">£0.00</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Sewer Standing</div>
                        <div class="summary-value" id="sewerStandTotal">£0.00</div>
                    </div>
                    <div class="summary-item total">
                        <div class="summary-label">Grand Total</div>
                        <div class="summary-value" id="grandTotal">£0.00</div>
                    </div>
                </div>

                <table id="monthlyTable">
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Days</th>
                            <th>Usage (m³)</th>
                            <th>Water Vol (£)</th>
                            <th>Water Stand (£)</th>
                            <th>Sewer Vol (£)</th>
                            <th>Sewer Stand (£)</th>
                            <th>Total (£)</th>
                        </tr>
                    </thead>
                    <tbody id="monthlyBody">
                    </tbody>
                </table>

                <div class="download-buttons">
                    <button class="download-btn" onclick="downloadCSV()">Download CSV</button>
                    <button class="download-btn" onclick="downloadPDF()">Download PDF</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let calculationData = null;

        document.getElementById('calculatorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            calculateBill();
        });

        function calculateBill() {
            try {
                // Clear previous errors
                document.getElementById('errorDiv').className = 'hidden';
                
                // Get inputs
                const waterStanding = parseFloat(document.getElementById('waterStanding').value);
                const waterVolumetric = parseFloat(document.getElementById('waterVolumetric').value);
                const sewerStanding = parseFloat(document.getElementById('sewerStanding').value);
                const sewerVolumetric = parseFloat(document.getElementById('sewerVolumetric').value);
                const sewerAllowance = parseFloat(document.getElementById('sewerAllowance').value);
                
                const startDate = new Date(document.getElementById('startDate').value);
                const endDate = new Date(document.getElementById('endDate').value);
                const startReading = parseFloat(document.getElementById('startReading').value);
                const endReading = parseFloat(document.getElementById('endReading').value);

                // Validation
                if (endDate <= startDate) {
                    throw new Error('End date must be after start date');
                }
                if (endReading <= startReading) {
                    throw new Error('End reading must be greater than start reading');
                }

                // Calculate total usage and days
                const totalUsage = endReading - startReading;
                const totalDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
                const usagePerDay = totalUsage / totalDays;

                // Calculate daily standing charges
                const dailyWaterStanding = waterStanding / 365;
                const dailySewerStanding = sewerStanding / 365;

                // Generate monthly breakdown
                const monthlyData = [];
                let currentDate = new Date(startDate);
                
                let totalWaterVol = 0;
                let totalWaterStand = 0;
                let totalSewerVol = 0;
                let totalSewerStand = 0;

                while (currentDate <= endDate) {
                    const monthStart = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
                    const monthEnd = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
                    
                    // Calculate days in this month within the billing period
                    const periodStart = currentDate < startDate ? startDate : (currentDate > monthStart ? currentDate : monthStart);
                    const periodEnd = monthEnd < endDate ? monthEnd : endDate;
                    
                    if (periodStart <= periodEnd) {
                        const daysInMonth = Math.ceil((periodEnd - periodStart) / (1000 * 60 * 60 * 24)) + 1;
                        const monthlyUsage = usagePerDay * daysInMonth;
                        
                        // Calculate charges for this month
                        const waterVol = monthlyUsage * waterVolumetric;
                        const waterStand = dailyWaterStanding * daysInMonth;
                        const sewerVol = monthlyUsage * (1 - sewerAllowance / 100) * sewerVolumetric;
                        const sewerStand = dailySewerStanding * daysInMonth;
                        const monthTotal = waterVol + waterStand + sewerVol + sewerStand;

                        monthlyData.push({
                            month: currentDate.toLocaleDateString('en-GB', { month: 'long', year: 'numeric' }),
                            days: daysInMonth,
                            usage: monthlyUsage,
                            waterVol: waterVol,
                            waterStand: waterStand,
                            sewerVol: sewerVol,
                            sewerStand: sewerStand,
                            total: monthTotal
                        });

                        totalWaterVol += waterVol;
                        totalWaterStand += waterStand;
                        totalSewerVol += sewerVol;
                        totalSewerStand += sewerStand;
                    }
                    
                    // Move to next month
                    currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1);
                }

                const grandTotal = totalWaterVol + totalWaterStand + totalSewerVol + totalSewerStand;

                // Store calculation data for downloads
                calculationData = {
                    summary: {
                        waterVol: totalWaterVol,
                        waterStand: totalWaterStand,
                        sewerVol: totalSewerVol,
                        sewerStand: totalSewerStand,
                        grandTotal: grandTotal
                    },
                    monthly: monthlyData,
                    inputs: {
                        waterStanding,
                        waterVolumetric,
                        sewerStanding,
                        sewerVolumetric,
                        sewerAllowance,
                        startDate: document.getElementById('startDate').value,
                        endDate: document.getElementById('endDate').value,
                        startReading,
                        endReading,
                        totalUsage,
                        totalDays
                    }
                };

                // Display results
                displayResults();
                
            } catch (error) {
                showError(error.message);
            }
        }

        function displayResults() {
            // Update summary
            document.getElementById('waterVolTotal').textContent = '£' + calculationData.summary.waterVol.toFixed(2);
            document.getElementById('waterStandTotal').textContent = '£' + calculationData.summary.waterStand.toFixed(2);
            document.getElementById('sewerVolTotal').textContent = '£' + calculationData.summary.sewerVol.toFixed(2);
            document.getElementById('sewerStandTotal').textContent = '£' + calculationData.summary.sewerStand.toFixed(2);
            document.getElementById('grandTotal').textContent = '£' + calculationData.summary.grandTotal.toFixed(2);

            // Update monthly table
            const tbody = document.getElementById('monthlyBody');
            tbody.innerHTML = '';
            
            calculationData.monthly.forEach(month => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${month.month}</td>
                    <td>${month.days}</td>
                    <td>${month.usage.toFixed(3)}</td>
                    <td>£${month.waterVol.toFixed(2)}</td>
                    <td>£${month.waterStand.toFixed(2)}</td>
                    <td>£${month.sewerVol.toFixed(2)}</td>
                    <td>£${month.sewerStand.toFixed(2)}</td>
                    <td>£${month.total.toFixed(2)}</td>
                `;
            });

            // Show results
            document.getElementById('results').classList.remove('hidden');
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorDiv');
            errorDiv.innerHTML = `<div class="error">Error: ${message}</div>`;
            errorDiv.classList.remove('hidden');
            errorDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function downloadCSV() {
            if (!calculationData) return;

            let csv = 'Water & Sewerage Bill Calculation\n\n';
            csv += 'Summary\n';
            csv += 'Water Volumetric,£' + calculationData.summary.waterVol.toFixed(2) + '\n';
            csv += 'Water Standing,£' + calculationData.summary.waterStand.toFixed(2) + '\n';
            csv += 'Sewer Volumetric,£' + calculationData.summary.sewerVol.toFixed(2) + '\n';
            csv += 'Sewer Standing,£' + calculationData.summary.sewerStand.toFixed(2) + '\n';
            csv += 'Grand Total,£' + calculationData.summary.grandTotal.toFixed(2) + '\n\n';

            csv += 'Monthly Breakdown\n';
            csv += 'Month,Days,Usage (m³),Water Vol (£),Water Stand (£),Sewer Vol (£),Sewer Stand (£),Total (£)\n';
            
            calculationData.monthly.forEach(month => {
                csv += `${month.month},${month.days},${month.usage.toFixed(3)},£${month.waterVol.toFixed(2)},£${month.waterStand.toFixed(2)},£${month.sewerVol.toFixed(2)},£${month.sewerStand.toFixed(2)},£${month.total.toFixed(2)}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', 'water_sewerage_bill.csv');
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function downloadPDF() {
            if (!calculationData) return;
            
            // Create a simple HTML page for printing/PDF
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Water & Sewerage Bill</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1, h2 { color: #333; }
                        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
                        th { background-color: #f2f2f2; }
                        .summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin: 20px 0; }
                        .summary-item { border: 1px solid #ddd; padding: 15px; text-align: center; }
                        .total { background-color: #007bff; color: white; font-weight: bold; }
                    </style>
                </head>
                <body>
                    <h1>Water & Sewerage Bill Calculation</h1>
                    <p><strong>Period:</strong> ${calculationData.inputs.startDate} to ${calculationData.inputs.endDate}</p>
                    <p><strong>Total Usage:</strong> ${calculationData.inputs.totalUsage.toFixed(3)} m³ over ${calculationData.inputs.totalDays} days</p>
                    
                    <h2>Summary</h2>
                    <div class="summary">
                        <div class="summary-item">
                            <div>Water Volumetric</div>
                            <div><strong>£${calculationData.summary.waterVol.toFixed(2)}</strong></div>
                        </div>
                        <div class="summary-item">
                            <div>Water Standing</div>
                            <div><strong>£${calculationData.summary.waterStand.toFixed(2)}</strong></div>
                        </div>
                        <div class="summary-item">
                            <div>Sewer Volumetric</div>
                            <div><strong>£${calculationData.summary.sewerVol.toFixed(2)}</strong></div>
                        </div>
                        <div class="summary-item">
                            <div>Sewer Standing</div>
                            <div><strong>£${calculationData.summary.sewerStand.toFixed(2)}</strong></div>
                        </div>
                        <div class="summary-item total">
                            <div>Grand Total</div>
                            <div><strong>£${calculationData.summary.grandTotal.toFixed(2)}</strong></div>
                        </div>
                    </div>
                    
                    <h2>Monthly Breakdown</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Month</th>
                                <th>Days</th>
                                <th>Usage (m³)</th>
                                <th>Water Vol (£)</th>
                                <th>Water Stand (£)</th>
                                <th>Sewer Vol (£)</th>
                                <th>Sewer Stand (£)</th>
                                <th>Total (£)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${calculationData.monthly.map(month => `
                                <tr>
                                    <td>${month.month}</td>
                                    <td>${month.days}</td>
                                    <td>${month.usage.toFixed(3)}</td>
                                    <td>£${month.waterVol.toFixed(2)}</td>
                                    <td>£${month.waterStand.toFixed(2)}</td>
                                    <td>£${month.sewerVol.toFixed(2)}</td>
                                    <td>£${month.sewerStand.toFixed(2)}</td>
                                    <td>£${month.total.toFixed(2)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </body>
                </html>
            `);
            printWindow.document.close();
            setTimeout(() => {
                printWindow.print();
            }, 500);
        }
    </script>
</body>
</html>